<!-- {% extends "base.html" %}

{% block script %} -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<link href="/api/static/css/solo.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf-8">
    // User Answer Via Buttons Logic
    var socket = io();

    var question = document.getElementById('question');
    var form = document.getElementById('form');
    var buttons = document.getElementsByClassName('answer_btn')
    var timer = document.getElementById('timer')

    var ans1 = document.getElementById("question_ans1");
    var ans2 = document.getElementById("question_ans2");
    var ans3 = document.getElementById("question_ans3");
    var ans4 = document.getElementById("question_ans4");

    var ans_list = [ans1, ans2, ans3, ans4]

    buttons.item(0).disabled = true
    buttons.item(1).disabled = true
    buttons.item(2).disabled = true
    buttons.item(3).disabled = true

    var user_input = null

    function startTimer(duration, display) {
        var timer = duration, minutes, seconds;
        var intervalId = setInterval(function () {
            minutes = parseInt(timer / 60, 10)
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                clearInterval(intervalId)
                socket.emit('timer');
            }

            buttons.item(0).disabled = false
            buttons.item(1).disabled = false
            buttons.item(2).disabled = false
            buttons.item(3).disabled = false
        }, 1000);
    }

    socket.on('counter', function(data) {

    // socket.emit('my event', {data: 'I\'m connected!'});
    });

    socket.on('question', function(data) {
        console.log(data)
        question_txt.textContent = data.question;
        for (let i = 0; i < 4; i++) {
            ans_list[i].innerText = data.answers[i]
        };
        correct_index = (data.answer_id - 1)
        window.scrollTo(0, document.body.scrollHeight);
    });

    buttons.item(0).addEventListener('click', function(e) {
        user_input = this.value
    });
    buttons.item(1).addEventListener('click', function(e) {
        user_input = this.value
    });
    buttons.item(2).addEventListener('click', function(e) {
        user_input = this.value
    });
    buttons.item(3).addEventListener('click', function(e) {
        user_input = this.value
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (user_input) {
        socket.emit('my event', user_input);
      }
      user_input = null
    });
    // 
    socket.on('connect', function(data) {
        startTimer(60, timer)
        // socket.emit('my event', {data: 'I\'m connected!'});
    });

    socket.on('redirect', function(destination) {
        console.log(destination)
        question.innerHTML = '';
        timer.innerText = 'Out of Time';
        buttons.item(0).disabled = true;
        buttons.item(1).disabled = true;
        buttons.item(2).disabled = true;
        buttons.item(3).disabled = true;
    });
</script>

<!-- % endblock %}

{% block content %} -->
<!-- arrow --> 
<div class="row" style="width: 100%;">
    <div class="col-2 align-self-start"><img id="arrow" src="/api/static/img/arrow.png" alt="arrow"></div>
</div>

<!-- score -->
<div id="scorediv" class="row justify-content-center">
    <div class="col-4">
        <div class="row">
            <img class="col" id="scorestar" src="/api/static/img/scorestar.png" alt="scorestar">
            <div id="score" class="col align-self-center">666</div>
        </div>
    </div>    
</div>
<!-- question -->
<div class="row">
    <div></div>
</div>



<!-- question frame -->
<div id="questionframediv" class="row"> 
    <img id="questionframe" src="/api/static/img/questionframe.png" alt="qsframe">
    <div id="question_txt">Are you gay?</div> 
    
</div>

<!-- Timer -->
<img id="timericon" src="/api/static/img/timer.png" alt="timericon">

<div id="timer">
    <p>666</p>      
</div>

<!--Choices-->
<div id="question" class="row">
    <div class="row justify-content-center">
        <div id="question_ans1" class="ans col-5 align-self-end">Yes</div>
        <div id="question_ans2" class="ans col-5 align-self-start">Ofcourse</div>
    </div>
    <div class="row justify-content-center">     
        <div id="question_ans3" class="ans col-5 align-self-end">Yeah</div>
        <div id="question_ans4" class="ans col-5 align-self-start">100%</div>
    </div>
   
</div>

<!--buttons-->
<form id="form" class="row justify-content-center">
    <div class="answer_btn col-1" id="btn1" type="submit" value="1"></div>
    <div class="answer_btn col-1" id="btn2" type="submit" value="2"></div>
    <div class="answer_btn col-1" id="btn3" type="submit" value="3"></div>
    <div class="answer_btn col-1" id="btn4" type="submit" value="4"></div>
</form>
<!-- {% endblock %} -->